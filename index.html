<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>CB AI Agent</title>

  <style type="text/css">
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', Arial, sans-serif;
      overflow-x: hidden;
    }

    .cb-chat-wrapper {
      font-family: inherit;
    }

    /* ================= LAUNCHER ================= */
    .cb-launcher {
      position: fixed;
      bottom: 25px;
      right: 25px;
      z-index: 10001;
      display: flex;
      align-items: center;
      background: #fff;
      border: 1px solid #d1d1d1;
      border-radius: 12px;
      padding: 6px 6px 6px 14px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .cb-launcher-logo {
      width: 30px;
      height: 30px;
      object-fit: contain;
    }

    .cb-launcher-text {
      font-weight: 600;
      font-size: 16px;
      color: #000;
      margin: 0 15px !important;
      position: relative;
      bottom: 10px;
     
    }

    .cb-launcher-icon-box {
      background: #0242bd;
      width: 34px;
      height: 34px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 22px;
      font-weight: bold;
    }

    /* ================= PANEL ================= */
    .cb-panel {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      background: #fff;
      z-index: 10002;
      display: none;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform .3s ease-out;
    }

    .cb-panel.open {
      display: flex;
      transform: translateX(0);
    }

    

    @media (min-width: 768px) {


      .cb-panel {
        inset: auto 0 0 auto;
        width: 420px;
        height: 100%;
        max-width: 90vw;
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
        box-shadow: -10px 0 30px rgba(0,0,0,0.1);
      }
    }

    /* ================= HEADER ================= */
    .cb-header-banner {
      background: #221C9E;
      color: #fff;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      height: 30px;
    }

    .cb-header-logo {
      width: 80px;
      height: 57px;
      object-fit: contain;
      margin-right: 10px;
    }

    .cb-banner-text {
      font-weight: 600;
      font-size: 18px;
      position: relative;
      bottom: 20px;
      margin-left:-12px;
    }

    .cb-close-btn {
      font-size: 34px;
      cursor: pointer;
      line-height: 1;
    }

    /* ================= CHAT CONTAINER ================= */
    .cb-chat-container {
      flex: 1;
      background: #fff;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative; 
    }

    #webchat {
      margin-bottom: 20px;
      flex: 1 !important;
      width: 100% !important;
      height: 100% !important;
    }

    .cb-ai-disclaimer {
      position: relative;
      bottom: 110px; 
      left: 0;
      right: 0;
      text-align: right;
      font-size: 10.5px;
      color: #666;
      background: rgba(255, 255, 255, 0.9);
      border-top: 2px solid #000;
      z-index: 5;
      pointer-events: none;
    }

    /* ================= WEBCHAT OVERRIDES ================= */
    [role="main"] .webchat__text-content,
    [role="main"] .webchat__text-content *,
    .webchat__send-box__text-box__input {
      font-size: 14px !important;
      color: #000 !important;
    }

/* Force the feedback container to be visible */
.webchat__text-content__activity-actions,
.webchat__feedback-form {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    height: auto !important;
    margin: 4px 0 !important;
}
.webchat__feedback-form__button {
    padding: 4px !important;
    min-width: 30px !important;
    min-height: 30px !important;
    cursor: pointer !important;
}

    /* Space out the last message so the disclaimer doesn't hide it */
    [role="main"] .webchat__basic-transcript__scrollable {
        padding-bottom: 80px !important; 
        
    }

      /* General webchat text fixes */
    [role="main"] .webchat__basic-transcript__activity-body {
      text-align: left !important;
      position:relative;
      top:50px;
    }

    .webchat__send-box__text-box__input {
      background: #f8f9fa !important;
    padding: 10px !important;
    font-size: 14px !important;
    
    /* Forces the fixed-height vertical scroll behavior */
    height: 100px !important;      /* Set your desired fixed height here */
    overflow-y: auto !important;   /* Enables vertical scrolling */
    white-space: pre-wrap !important; 
    display: block !important;
}
    

    .webchat__suggested-actions__stack{
      margin-bottom: 24px !important;
    }

    /* Suggested actions */
    [role="main"] .webchat__suggested-actions__item-list {
      flex-direction: column !important;
      align-items: flex-end !important;
      padding: 5px 10px 15px !important;
      margin: 0 !important;
    }

    [role="main"] .webchat__suggested-action {
      width: 83% !important;
      border: 1px solid #0242bd !important;
      border-radius: 10px !important;
      background: #fff !important;
      margin-left: auto !important;
      
    }

    [role="main"] .webchat__suggested-action:hover {
      background: #e3f2fd !important;
    }

    [role="main"] .webchat__suggested-action__text {
      color: #000 !important;
      font-size: 10.5px !important;
      text-align: center !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
    }

    /* Send box styling */
    [role="main"] .webchat__send-box__main {
     border: 1px solid #000 !important;
    border-radius: 10px !important;
    margin: 8px 12px !important;
    z-index: 10 !important;
    background: #fff;
    
    /* Prevents the container from growing with the text */
    max-height: 120px !important; 
    overflow: hidden !important; 
    display: flex !important;
    align-items: center !important;
    }

    /* Hide citations */
    .webchat__render-markdown__pure-identifier,
    .webchat__render-markdown__citation,
    .webchat__citation,
    .webchat__link-definitions__list,
    .webchat__link-definitions__header,
    button.webchat__link-definitions__list-item {
      display: none !important;
    }

    /* AI အဖြေထဲက Follow-up list တွေကို Button ပုံစံပြောင်းခြင်း */
[role="main"] .webchat__text-content ol {
    padding: 0 !important;
    margin: 10px 0 !important;
    list-style-type: none !important; /* နံပါတ်စဉ်တွေ ဖျောက်ရန် */
}

[role="main"] .webchat__text-content ol li {
    display: block !important;
    background: #ffffff !important;
    border: 1.5px solid #0242bd !important;
    border-radius: 20px !important;
    padding: 10px 15px !important;
    margin-bottom: 8px !important;
    cursor: pointer !important;
    color: #0242bd !important;
    font-size: 13px !important;
    font-weight: 500 !important;
    text-align: center !important;
    transition: all 0.2s ease;
}

[role="main"] .webchat__text-content ol li:hover {
    background: #eef4ff !important;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
    /* ================= MOBILE FIX ================= */
    @media (max-width: 767px) {
      
      .cb-launcher {
        bottom: 16px;
        right: 16px;
      }
      
      .cb-ai-disclaimer {
        bottom: 120px;
        font-size: 10px;
        background:#ffffff !important
        
      }

      [role="main"] .webchat__send-box__main {
        margin: 15px 10px !important;
      }
    }
  </style>
</head>
<body>

<div class="cb-chat-wrapper" id="cb-ai-wrapper">
  <div class="cb-launcher" id="chat-launcher" onclick="openCbChat()">
    <div class="cb-launcher-content">
      <img alt="CB" class="cb-launcher-logo" src="https://play-lh.googleusercontent.com/7E8SgT9CCbsd73Vnbr3cD9E5a2LIiNaKL9cGhWHXq4JuTJd7mxu4DkF1-yI74APnqog" />
      <span class="cb-launcher-text">CB AI Agent</span>
    </div>
    <div class="cb-launcher-icon-box"><span class="cb-plus-icon">+</span></div>
  </div>

  <div class="cb-panel" id="cb-chat-panel">
    <div class="cb-header-banner">
      <div class="cb-header-left">
         <div class="cb-header-left"><img alt="CB Logo" class="cb-header-logo" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQYHjIhHhwcHj0sLiQySUBMS0dARkVQWnNiUFVtVkVGZIhlbXd7gYKBTmCNl4x9lnN+gXz/2wBDARUXFx4aHjshITt8U0ZTfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHz/wAARCAAnAG4DASIAAhEBAxEB/8QAGgABAAMBAQEAAAAAAAAAAAAAAAMEBgUHAf/EACsQAAEEAgECAwgDAAAAAAAAAAEAAgMEBRExEkETISIGFDIzcYGRoRVRYv/EABkBAQADAQEAAAAAAAAAAAAAAAABAgMEBf/EAB8RAQEAAgEEAwAAAAAAAAAAAAABAhEEAyExQRJSgf/aAAwDAQACEQMRAD8AzyIi9hQREQEAJOgNlW8fj58hMI4W+Xd3YLW0sRToADw/Hn77GwFln1Zh29p0yMONtz/LgeftpWP4DJa37sfyFt9yAac9kY7AJ1efzj+FheRl6idMBNjrcHzIHj7bVUgg6I0V6Tt5Gg5ko7grm3cNTvggM8CftoaBVseR9ojTEIrWQx8+PnMczfo7sVVXVLLNxAiIgIiICmqVn27LIYxtzioVax96TH2BNEAT3BUXeuw3FSoyjA2rXADtet6lbwREelg+KQqrj8hDkYR4Lg2Rx28HkKzI+NsbpJT0wRftebd77+VhgBO4oy/+3OUvTLviP6LH5P2isWXllYmGIeQ1yVyve7G9+M/f1W04+Vm6begSAA7ljMf+m8L67gNl9TT8Mg7LKYv2inrPDLRMsJ53yFqo3MLGvjPXBL+lnnhcPIiuU2X4HVbA9YG2PWEtV31bD4ZBpzSttkMjDjodTO6pWn0AclYzIXZL9l00oAJ7Bb8f5fiKrIiLqQIiICIiCSCeSvKJIXlrh3C6uQzzr2OZXLel+/URwURVuMt3RxkRFYF2cfnnUsc+uGlz9+gnhoRFXLGZTVHKnnksSmSZ5e88kqNEVgREQf/Z" /> <span class="cb-banner-text">CB AI Agent</span></div>

      </div>
      <div class="cb-close-btn" onclick="closeCbChat()">×</div>
    </div>

    <div class="cb-chat-container">
      <div id="webchat" role="main"></div>
      
      <div class="cb-ai-disclaimer" id="ai-disclaimer-box">
        <i>This message is generated by AI to provide faster assistance.</i>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
<script>
  const botSecret = "SECRET_PLACEHOLDER";
  // အရေးကြီးသည်- store ကို အပြင်မှာ ကြေညာထားမှ click event က လှမ်းသုံးနိုင်မှာပါ
  let store;
  let hasRendered = false;

  function openCbChat() {
    document.getElementById('cb-chat-panel').classList.add('open');
    document.getElementById('chat-launcher').style.display = 'none';
    renderCbChat();
  }

  function closeCbChat() {
    const panel = document.getElementById('cb-chat-panel');
    panel.classList.remove('open');
    setTimeout(() => {
      document.getElementById('chat-launcher').style.display = 'flex';
    }, 350);
  }

  function renderCbChat() {
    if (hasRendered) return;
    hasRendered = true;

    // Web Chat Store ကို Global variable ထဲသို့ ထည့်သွင်းခြင်း
    store = window.WebChat.createStore({}, ({ dispatch }) => next => action => {
      if (action.type === 'DIRECT_LINE/CONNECT_FULFILLED') {
        dispatch({ type: 'WEB_CHAT/SEND_EVENT', payload: { name: 'startConversation', value: '' } });
      }
      return next(action);
    });

    const styleOptions = {
      accent: '#0242bd',
      bubbleBackground: '#f5fbfc',
      bubbleTextColor: '#000000',
      bubbleBorderRadius: 10,
      bubbleFromUserBackground: '#e0faff',
      bubbleFromUserBorderColor: '#d1d1d1',
      bubbleFromUserBorderRadius: 10,
      sendBoxHeight: 60,
      sendBoxMaxHeight: 45,
      sendBoxTextWrap: true,
      hideUploadButton: true,
      hideFeedbackButtons: false,
      showSpokenHelp: false,
      feedbackGroupTitle: 'Was this helpful?',
      suggestedActionLayout: 'stacked'
    };

    window.WebChat.renderWebChat({
      directLine: window.WebChat.createDirectLine({ secret: botSecret }),
      store: store, // store ကို ဒီမှာ ချိတ်ဆက်ပါ
      styleOptions: styleOptions
    }, document.getElementById('webchat'));
  }

  // Follow-up Question Buttons ကို Click လုပ်လျှင် အလုပ်လုပ်စေမည့် Logic
  document.addEventListener('click', function (e) {
    // UI ထဲက list items (li) ကို နှိပ်လိုက်သလား စစ်ဆေးခြင်း
    const listItem = e.target.closest('.webchat__text-content ol li, .webchat__text-content ul li');
    
    if (listItem && store) {
      // 1. Button ထဲက စာသားကို ရယူခြင်း
      const questionText = listItem.innerText.trim();
      
      // 2. Bot ဆီသို့ စာတိုက်ရိုက်ပို့ခြင်း (Dispatch action)
      // ဒီနည်းလမ်းက Bot ကို အဖြေပြန်ပေးဖို့ trigger လုပ်ပေးပါတယ်
      store.dispatch({
        type: 'WEB_CHAT/SEND_MESSAGE',
        payload: { text: questionText }
      });

      // 3. User နှိပ်လိုက်ကြောင်း သိသာစေရန် effect ပေးခြင်း
      listItem.style.opacity = "0.6";
      setTimeout(() => { listItem.style.opacity = "1"; }, 300);
    }
  });
</script>

</body>
</html>
